---
name: Whirlpool Stats Tools - Anonsets
description: Понимание концепции анонимного набора и как его рассчитать с помощью WST
---
![cover](assets/cover.webp)

***ВНИМАНИЕ:** После ареста основателей кошелька Samourai и изъятия их серверов 24 апреля, инструмент Whirlpool Stats Tool больше недоступен для скачивания, так как он был размещен на Gitlab Samourai. Даже если вы ранее скачали этот инструмент локально на свой компьютер или он был установлен на вашем узле RoninDojo, WST в настоящее время не функционирует. Его работа зависела от данных, предоставляемых сайтом OXT.me, который теперь недоступен. В настоящее время WST не особенно полезен, поскольку протокол Whirlpool неактивен. Тем не менее, возможно, что эти программы могут быть восстановлены в ближайшие недели. Кроме того, теоретическая часть этой статьи остается актуальной для понимания принципов и целей coinjoins в целом (не только Whirlpool), а также для понимания эффективности модели Whirlpool. Вы также можете узнать, как количественно оценить конфиденциальность, предоставляемую циклами coinjoin.*

_Мы внимательно следим за развитием этого дела, а также за развитием связанных с ним инструментов. Будьте уверены, что мы обновим этот учебник, как только появится новая информация._

_Этот учебник предоставляется только в образовательных и информационных целях. Мы не поддерживаем и не поощряем использование этих инструментов в преступных целях. Каждый пользователь несет ответственность за соблюдение законов в своей юрисдикции._

---

*"Разорвите след, который оставляют ваши монеты"*

В этом учебнике мы изучим концепцию анонимных наборов, индикаторов, которые позволяют нам оценить качество процесса coinjoin на Whirlpool. Мы рассмотрим метод расчета и интерпретации этих индикаторов. После теоретической части мы перейдем к практике, научившись рассчитывать анонимные наборы конкретной транзакции с помощью инструмента на Python *Whirlpool Stats Tools* (WST).

## Что такое coinjoin в Bitcoin?
**Coinjoin - это техника, которая нарушает прослеживаемость биткойнов в блокчейне**. Она основана на совместной транзакции с определенной структурой одноименного типа: транзакция coinjoin.

Транзакции coinjoin повышают конфиденциальность пользователей Bitcoin, усложняя анализ цепочек для внешних наблюдателей. Их структура позволяет объединять множество монет от разных пользователей в одну транзакцию, тем самым затемняя следы и затрудняя определение связей между входными и выходными адресами.

Принцип coinjoin основан на совместном подходе: несколько пользователей, желающих смешать свои биткойны, вносят одинаковые суммы в качестве входов одной и той же транзакции. Затем эти суммы распределяются в выходах эквивалентной стоимости. В конце транзакции становится невозможным связать конкретный выход с данным пользователем. Между входами и выходами нет прямой связи, тем самым разрывая ассоциацию между пользователями и их UTXO, а также историю каждой монеты.

![coinjoin](assets/notext/1.webp)

Пример транзакции coinjoin:
[323df21f0b0756f98336437aa3d2fb87e02b59f1946b714a7b09df04d429dec2](https://mempool.space/tx/323df21f0b0756f98336437aa3d2fb87e02b59f1946b714a7b09df04d429dec2)
Для выполнения coinjoin, обеспечивая при этом контроль каждого пользователя над своими средствами на протяжении всего процесса, начинают с создания транзакции координатором, который затем передает ее каждому участнику. Каждый пользователь подписывает транзакцию после проверки того, что она им подходит. Все собранные подписи в конечном итоге интегрируются в транзакцию. Если пользователь или координатор попытаются перенаправить средства, изменив выходы транзакции coinjoin, подписи окажутся недействительными, что приведет к отклонению транзакции узлами.
Существует несколько реализаций coinjoin, таких как Whirlpool, JoinMarket или Wabisabi, каждая из которых направлена на управление координацией между участниками и повышение эффективности транзакций coinjoin.
В этом руководстве мы сосредоточимся на моей любимой реализации: Whirlpool, которая доступна в Samourai Wallet и Sparrow Wallet. На мой взгляд, это самая эффективная реализация для coinjoins на Bitcoin.
## Какова польза coinjoin на Bitcoin?
Польза coinjoin заключается в его способности создавать правдоподобное отрицание, путем смешивания вашей монеты в группе неразличимых монет. Цель этого действия - разорвать связи трассировки, как от прошлого к настоящему, так и от настоящего к прошлому.

Другими словами, аналитик, знающий вашу исходную транзакцию на входе в циклы coinjoin, не должен быть в состоянии с уверенностью идентифицировать ваш UTXO на выходе из циклов ремикса (анализ с входа в цикл до выхода из цикла).

![coinjoin](assets/en/2.webp)

Наоборот, аналитик, знающий ваш UTXO на выходе из циклов coinjoin, не должен быть в состоянии определить исходную транзакцию на входе в циклы (анализ с выхода из цикла на вход в цикл).

![coinjoin](assets/en/3.webp)

Для оценки сложности для аналитика связать прошлое с настоящим и наоборот, необходимо количественно определить размер групп, в которых ваша монета скрыта. Эта мера говорит нам о количестве анализов с одинаковой вероятностью. Таким образом, если правильный анализ теряется среди 3 других анализов с равной вероятностью, ваш уровень сокрытия очень низок. С другой стороны, если правильный анализ находится в наборе из 20 000 анализов, все одинаково вероятные, ваша монета очень хорошо скрыта.

И именно размер этих групп представляет собой показатели, которые называются "anonsets".

## Понимание anonsets
Anonsets служат показателями для оценки степени конфиденциальности конкретного UTXO. Более конкретно, они измеряют количество неразличимых UTXO в наборе, который включает изучаемую монету. Требование к однородному набору UTXO означает, что anonsets обычно рассчитываются по циклам coinjoin. Использование этих показателей особенно актуально для coinjoins Whirlpool из-за их однородности.

Anonsets позволяют, при необходимости, судить о качестве coinjoins. Большой размер anonset означает повышенный уровень анонимности, поскольку становится сложно выделить конкретный UTXO в наборе.

Существует два типа anonsets:
- **Перспективный набор анонимности;**
- **Ретроспективный набор анонимности.**
Первый показатель показывает размер группы, среди которой скрыт изучаемый UTXO в конце цикла, зная UTXO на входе, то есть количество неразличимых монет, присутствующих в этой группе. Этот показатель позволяет измерить устойчивость конфиденциальности монеты против анализа от прошлого к настоящему (от входа к выходу). На английском название этого показателя - "*forward anonset*", или "*forward-looking metrics*".
![coinjoin](assets/en/4.webp)
Этот показатель оценивает степень защиты вашего UTXO от попыток восстановить его историю от точки входа до точки выхода в процессе coinjoin.

Например, если ваша транзакция участвовала в своем первом цикле coinjoin и было завершено еще два последующих цикла, проспективный anonset вашей монеты будет `13`:

![coinjoin](assets/en/5.webp)

Второй индикатор показывает количество возможных источников для данной монеты, зная UTXO в конце цикла. Этот индикатор измеряет устойчивость конфиденциальности монеты к анализу от настоящего к прошлому (от выхода к входу), то есть насколько сложно аналитику проследить до источника вашей монеты, до циклов coinjoin. На английском название этого индикатора - "*backward anonset*", или "*backward-looking metrics*".

![coinjoin](assets/en/6.webp)

Зная ваш UTXO на выходе из циклов, ретроспективный anonset определяет количество потенциальных транзакций Tx0, которые могли составить ваш вход в циклы coinjoin. На диаграмме ниже это соответствует сумме всех оранжевых пузырьков.

![coinjoin](assets/en/7.webp)

## Расчет anonset с помощью инструментов Whirlpool Stats Tools (WST)
Чтобы самостоятельно рассчитать эти показатели для ваших монет, прошедших через циклы coinjoin, вы можете использовать инструмент, специально разработанный Samourai Wallet: *Whirlpool Stats Tools*.

Если у вас есть RoninDojo, WST предустановлен на вашем узле. Поэтому вы можете пропустить шаги установки и сразу перейти к шагам использования. Для тех, у кого нет узла RoninDojo, давайте посмотрим, как произвести установку этого инструмента на компьютер.

Вам понадобится: Tor Browser (или Tor), Python версии 3.4.4 или выше, git и pip. Откройте терминал. Чтобы проверить наличие и версию этих программ на вашей системе, введите следующие команды:
```plaintext
python --version
git --version
pip --version
```

При необходимости вы можете скачать их с соответствующих сайтов:
- https://www.python.org/downloads/ (pip поставляется вместе с Python начиная с версии 3.4);
- https://www.torproject.org/download/;
- https://git-scm.com/downloads.
После установки всех этих программ, из терминала, клонируйте репозиторий WST:
```plaintext
git clone https://code.samourai.io/whirlpool/whirlpool_stats.git
```

![WST](assets/notext/8.webp)

Перейдите в директорию WST:
```plaintext
cd whirlpool_stats
```

Установите зависимости:
```plaintext
pip3 install -r ./requirements.txt
```

![WST](assets/notext/9.webp)

Также вы можете установить их вручную (необязательно):
```plaintext
pip install PySocks
pip install requests[socks]
pip install plotly
pip install datasketch
pip install numpy
pip install python-bitcoinrpc
```

Перейдите в подпапку `/whirlpool_stats`:
```plaintext
cd whirlpool_stats
```

Запустите WST:
```plaintext
python3 wst.py
```

![WST](assets/notext/10.webp)

Запустите Tor или Tor Browser в фоновом режиме.

**-> Для пользователей RoninDojo, вы можете продолжить учебник прямо отсюда.**

Установите прокси на Tor (RoninDojo),
```plaintext
socks5 127.0.0.1:9050
```
или в Tor Browser, в зависимости от того, что вы используете:
```plaintext
socks5 127.0.0.1:9150
```

Эта манипуляция позволит вам скачивать данные по OXT через Tor, чтобы не раскрывать информацию о ваших транзакциях. Если вы новичок и этот шаг кажется сложным, знайте, что он просто включает в себя направление вашего интернет-трафика через Tor. Самый простой метод состоит в запуске Tor Browser в фоновом режиме на вашем компьютере, а затем выполнении только второй команды для подключения через этот браузер (`socks5 127.0.0.1:9150`).

![WST](assets/notext/11.webp)

Далее перейдите в рабочий каталог, из которого вы намереваетесь скачать данные WST, используя команду `workdir`. Эта папка будет служить для хранения транзакционных данных, которые вы получите из OXT в форме файлов `.csv`. Эта информация необходима для расчета индикаторов, которые вы хотите получить. Вы свободны в выборе местоположения этого каталога. Было бы разумно создать папку специально для данных WST. К примеру, давайте выберем папку загрузок. Если вы используете RoninDojo, этот шаг не нужен:
```plaintext
workdir path/to/your/directory
```

Затем командная строка должна измениться, чтобы указать ваш рабочий каталог.

![WST](assets/notext/12.webp)

Затем скачайте данные из пула, содержащего вашу транзакцию. Например, если я нахожусь в пуле `100,000 сатоши`, команда будет:
```plaintext
download 0001
```

![WST](assets/notext/13.webp)

Коды номиналов на WST следующие:
- Пул 0.5 биткоина: `05`
- Пул 0.05 биткоина: `005`
- Пул 0.01 биткоина: `001`
- Пул 0.001 биткоина: `0001`
После скачивания данных загрузите их. Например, если я нахожусь в пуле `100,000 сатоши`, команда будет:
```plaintext
load 0001
```

Этот шаг займет несколько минут в зависимости от вашего компьютера. Теперь хорошее время, чтобы сделать себе кофе! :)

![WST](assets/notext/14.webp)

После загрузки данных введите команду `score`, за которой следует ваш TXID (идентификатор транзакции), чтобы получить его анонимные наборы:
```plaintext
score TXID
```

**Внимание**, выбор TXID для использования варьируется в зависимости от анонимного набора, который вы хотите рассчитать. Чтобы оценить перспективный анонимный набор монеты, необходимо ввести через команду `score` TXID, соответствующий ее первому coinjoin, который является начальным смешиванием с этим UTXO. С другой стороны, чтобы определить ретроспективный анонимный набор, вы должны ввести TXID последнего выполненного coinjoin. Подытожив, перспективный анонимный набор рассчитывается из TXID первого смешивания, в то время как ретроспективный анонимный набор рассчитывается из TXID последнего смешивания.

WST затем отображает ретроспективный счет (*Метрики с обратным взглядом*) и перспективный счет (*Метрики с взглядом вперед*). Например, я взял TXID случайной монеты на Whirlpool, которая мне не принадлежит.

![WST](assets/notext/15.webp)
Спорная транзакция: [7fe6081fa4f4382be629fb2ef59029d058a22b6fd59cb31d1511fe9e0e7f32be](https://mempool.space/tx/7fe6081fa4f4382be629fb2ef59029d058a22b6fd59cb31d1511fe9e0e7f32be)
Если рассматривать эту транзакцию как первый coinjoin для данной монеты, то она получает потенциальный anonset в размере `86,871`. Это означает, что она скрыта среди `86,871` неразличимых монет. Для внешнего наблюдателя, который знает эту монету в начале циклов coinjoin и пытается проследить ее вывод, он столкнется с `86,871` возможными UTXO, каждый из которых имеет одинаковую вероятность быть искомой монетой.

Если рассматривать эту транзакцию как последний coinjoin монеты, то она получает ретроспективный anonset в размере `42,185`. Это означает, что существует `42,185` потенциальных источников для этого UTXO. Если внешний наблюдатель определяет эту монету в конце циклов и стремится проследить ее происхождение, он столкнется с `42,185` возможными источниками, все с равной вероятностью быть искомым происхождением.
Помимо оценок anonset, WST также предоставляет вам информацию о скорости диффузии вашего вывода в пуле на основе anonset. Этот другой показатель просто позволяет вам оценить потенциал улучшения вашей части. Этот показатель особенно полезен для потенциального anonset. Действительно, если ваша часть имеет скорость диффузии 15%, это означает, что она может быть спутана с 15% частей в пуле. Это хорошо, но у вас все еще есть очень большой запас для улучшения за счет продолжения ремикса. С другой стороны, если ваша часть имеет скорость диффузии 95%, то вы приближаетесь к пределам пула. Вы можете продолжать ремикс, но ваш anonset не увеличится значительно.

Важно отметить, что расчеты anonset, выполненные WST, не являются абсолютно точными. Учитывая огромный объем данных для обработки, WST использует алгоритм *HyperLogLogPlusPlus* для значительного снижения нагрузки, связанной с локальной обработкой данных и необходимой памятью. Это алгоритм, позволяющий оценить количество уникальных значений в очень больших наборах данных, сохраняя при этом высокую точность результата. Поэтому предоставленные оценки достаточно хороши для использования в ваших анализах, так как они очень близки к реальности, но их не следует интерпретировать как точные значения до единицы.

В заключение, помните, что не обязательно систематически рассчитывать anonset для каждой вашей части в coinjoins. Сама конструкция Whirlpool уже предоставляет гарантии. Действительно, ретроспективный anonset редко является предметом беспокойства. С вашего первоначального смешивания вы получаете особенно высокий ретроспективный показатель благодаря наследию предыдущих смешиваний с момента Genesis coinjoin. Что касается потенциального anonset, достаточно держать вашу часть в аккаунте после смешивания достаточно долгий период.
Вот почему я считаю использование Whirlpool особенно актуальным в стратегии *Хранить -> Смешивать -> Тратить -> Заменять*. На мой взгляд, наиболее логичным подходом является сохранение основной части сбережений в биткоинах в холодном кошельке, при этом постоянно поддерживая определенное количество монет в coinjoins на Samourai для покрытия повседневных расходов. Как только биткоины из coinjoins потрачены, они заменяются новыми, чтобы вернуться к определенному порогу смешанных монет. Этот метод позволяет освободиться от беспокойства по поводу наших UTXO anonsets, делая время, необходимое для эффективности coinjoins, гораздо менее ограничивающим.
**Внешние ресурсы:**

- [Подкаст на французском о анализе цепочек](https://fountain.fm/episode/6nNoQEUHBCQR8hAXAkEx)
- [Статья в Википедии о HyperLogLog](https://en.wikipedia.org/wiki/HyperLogLog)
- Репозиторий Samourai для статистики Whirlpool
- Веб-сайт Whirlpool от Samourai
- [Статья на Medium на английском о конфиденциальности и Биткоине от Samourai](https://medium.com/oxt-research/understanding-bitcoin-privacy-with-oxt-part-1-4-8177a40a5923)
- [Статья на Medium на английском о концепции анонимного набора от Samourai](https://medium.com/samourai-wallet/diving-head-first-into-whirlpool-anonymity-sets-4156a54b0bc7)